<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Droga Programisty">
    <title>Szybkie palce!</title>
</head>
<body>
    <h1>Gra Szybkie Palce!</h1>
    <input type="button" value="START" onclick="RozpocznijGre()">
    <textarea id="dziennikZdarzen" cols="100" rows="20"></textarea>
    <script>
        // 1. Wyswietlenie okienka Graczom
        alert('Witaj w grze Szybkie Palce! Aby rozpocząć kliknij w przycisk "START"');
        // 2. Wywolanie funkcji logujacej komunikat dla Graczy
        Zanotuj('Po wyświetleniu napisu "Pojedynek!" Gracze naciskają swoje klawisze. Kto pierwszy ten lepszy!');
        Zanotuj('Klawisz Gracza nr 1: q');
        Zanotuj('Klawisz Gracza nr 2: p');
        Zanotuj('------------------------');
        Zanotuj('Aby rozpocząć grę naciśnij "START"');
        Zanotuj('------------------------');

        // 3. Zdefiniowanie zmiennych Gry
        var punktyGracz1;
        var punktyGracz2;
        var czasRundy;
        var licznikNacisniecGracz1;
        var licznikNacisniecGracz2;
        var limitNacisniec;
        var liczbaRund;
        var minimalnyCzasRundy;
        var czyPojedynekTrwa; 
        var przyciskGracz1;
        var przyciskGracz2;

        // 4. Funkcje i logika Gry

        // Funkcja sluzy do rozpoczynania nowej gry
        function RozpocznijGre() {
            Zanotuj('Rozpoczynamy Grę!');
            // ustawienie poczatkowych wartosci zmiennych
            punktyGracz1 = 0;
            punktyGracz2 = 0;
            licznikNacisniecGracz1 = 0;
            licznikNacisniecGracz2 = 0;
            liczbaRund = 3;
            limitNacisniec = liczbaRund;
            minimalnyCzasRundy = 5;
            przyciskGracz1 = 81; // klawisz q
            przyciskGracz2 = 80; // klawisz p
            RozpocznijRunde();
        }

        // Funkcja ktora losuje czas rundy uwzgledniajac 'minimalnyCzasRundy'
        // oraz losowy czas od 1 do 5 sekund
        function WylosujCzasRundy(minimalnyCzasRundy) {
            var czasLosowy = Math.floor(1 + Math.random() * 5);
            return minimalnyCzasRundy + czasLosowy;
        }

        // Funkcja ktora loguje wiadomosc podczas dzialania gry.
        // Wiadomosc jest wyswietlana w konsoli oraz na okienku tekstowym o nazwie 'dziennikZdarzen'.
        function Zanotuj(wiadomosc) {
            console.log(wiadomosc);
            document.getElementById('dziennikZdarzen').value += wiadomosc + '\r\n'
        }

        // Funkcja ktora rozpoczyna kolejna runde
        // Ustawia stoper na czasRundy
        function RozpocznijRunde() {
            czyPojedynekTrwa = false;
            czasRundy = WylosujCzasRundy(minimalnyCzasRundy);
            Zanotuj('------------------------');
            Zanotuj('Rozpoczęcie rundy. Czas rundy wynosi: ' + czasRundy + ' sekund.');

            // poniewaz czasRundy jest w sekundach a funkcja setTimeout przyjmuje milisekundy
            window.setTimeout(Pojedynek, czasRundy * 1000); 
        }

        // Funkcja ktora oznajmia Graczom ze wlasnie rozpoczal sie ich pojedynek
        function Pojedynek() {
            czyPojedynekTrwa = true;
            Zanotuj('Pojedynek!');
        }

        // Funkcja obslugujaca logike naciskania klawisza przez Graczy
        function NacisnietoPrzycisk(przycisk) {
            if(przycisk.keyCode == przyciskGracz1) {
                
                licznikNacisniecGracz1++;
                if(czyPojedynekTrwa) {
                    punktyGracz1++;
                    Zanotuj('Klawisz nacisnął Gracz nr 1. Licznik: ' + licznikNacisniecGracz1 + '. Punkty: ' + punktyGracz1);
                    KoniecRundy();
                }

            }else if(przycisk.keyCode == przyciskGracz2) {

                licznikNacisniecGracz2++;
                if(czyPojedynekTrwa) {
                    punktyGracz2++;
                    Zanotuj('Klawisz nacisnął Gracz nr 2. Licznik: ' + licznikNacisniecGracz2 + '. Punkty: ' + punktyGracz2);
                    KoniecRundy();
                }
            }
        }

        function KoniecRundy() {
            czyPojedynekTrwa = false;

            // ...
            // Tutaj bedziemy sprawdzac czy ktorys Gracz wygral
            // Na razie rozpoczynamy kolejna runde :)
            // ...

            RozpocznijRunde();
        }

        // Rejestracja nasluchiwania na nacisniecie klawisza
        // Mowimy przygladarce ze jestesmy zainteresowani zdarzeniem keydown
        document.addEventListener('keydown', NacisnietoPrzycisk);

    </script>

</body>
</html>